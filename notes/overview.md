### **The Rain Protocol: A Unified Architectural Overview**

#### **Abstract**

Rain Protocol is a decentralized digital economy designed to function in both connected and disconnected environments. Its architecture is a layered stack that separates concerns, from decentralized identity at its base to user-facing applications at its peak. This document provides a concise overview of this architecture, detailing the roles of its core smart contracts, the function of its native tokens, and how the layers work in concert to create a secure, self-sustaining, and reputation-based financial ecosystem.

---

#### **Layer 0: Decentralized Identity & Trust Root**

This is the foundational layer that establishes who can participate in the economy. It is built on the principle of costly, non-transferable identity to prevent Sybil attacks.

*   **Implementation:** The `RainReputation.sol` contract.
*   **Identity Primitive:** Each user is issued a non-transferable ERC721 token, or **Soulbound Token (SBT)**. This token acts as a permanent, foundational digital identity within the ecosystem. It is earned, not bought or traded.
*   **Sybil Resistance:** New users are onboarded through a **"Web of Trust"** governance process. A new user must be sponsored by existing members who co-stake a financial bond. This "skin-in-the-game" mechanism ensures sponsors are held accountable and makes the creation of fake identities prohibitively expensive.

---

#### **Layer 1: The Settlement Layer**

This is the underlying blockchain that serves as the ultimate, immutable source of truth for all transactions and asset ownership.

*   **Implementation:** A low-cost, high-throughput blockchain (e.g., an Ethereum L2 like Arbitrum or Polygon).
*   **Unit of Account:** All economic activity is denominated in a trusted, fiat-backed stablecoin (e.g., USDC), represented by the `CurrencyToken.sol` contract within the protocol.

---

#### **Layer 2: The Agreement Layer (The Protocol Core)**

This is the heart of the protocol, where the rules of the economy are defined and autonomously enforced by a suite of interconnected smart contracts. This layer follows the **Arbiter-Ledger** security model.

*   **The Ledger (`RainReputation.sol`):** This is the unified core engine of the entire system. Its responsibilities are:
    1.  **Identity Management:** Minting the SBTs that anchor Layer 0.
    2.  **Reputation Scoring:** Maintaining the authoritative reputation score for every user.
    3.  **Economic Gateway:** Serving as the universal gateway for protocol revenue via its `authorizeAction()` function, which charges a fee for instantaneous, reputation-gated services.
    4.  **Collateral Management:** Managing the `stake()` and `slash()` functions for users committing their reputation as long-term collateral.

*   **The Economic Engine (`TreasuryV2.sol`):** This contract is the protocol's autonomous economic heart. Its responsibilities are:
    1.  **Fee Aggregation:** Acting as the central collection point for all protocol fees generated by `RainReputation.authorizeAction()`.
    2.  **Dividend Distribution:** Investing its capital to generate yield and distributing this yield back to users as a Reputation Dividend, using a scalable and secure Merkle drop mechanism.

*   **The Arbiters (e.g., `LoanContract.sol`, `JuryContract.sol`):** This is a suite of specialized, trusted smart contracts that contain the context-specific business logic of the ecosystem. They are the only contracts permitted to command the Ledger. Each Arbiter is an expert in its domain (e.g., credit, dispute resolution) and is responsible for judging outcomes and instructing the `RainReputation` contract to increase or decrease scores accordingly. Every Arbiter must pass a rigorous governance audit to become trusted.

---

#### **Layer 3: The Application Layer**

This is the user-facing layer, consisting of applications that interact with the Layer 2 contracts to provide services to the end-user.

*   **Implementation:** An offline-first mobile application.
*   **Features:**
    *   **Online Mode:** Functions as a standard crypto wallet, displaying the user's reputation score, transaction history, and allowing interaction with online services like the `LoanContract`.
    *   **Offline Mode:** Uses the `authorizeAction()` function from the `RainReputation` contract to mint single-use offline transaction tokens, presented as QR codes for peer-to-peer commerce.
    *   **"Sneakernet" Syncing:** A dynamic fee market where agents are incentivized to batch and settle offline transactions to the Layer 1 blockchain, ensuring eventual consistency.

---

#### **Tokens of the Ecosystem**

The Rain economy is powered by two core tokens:

1.  **RAIN (Reputation SBT):**
    *   **Type:** Non-transferable ERC721 (Soulbound Token).
    *   **Function:** Represents a user's identity and is the anchor for their reputation score.
    *   **Acquisition:** It cannot be bought or sold. It is granted upon successful entry into the ecosystem and its value (the score) is earned through trustworthy behavior.

2.  **DMD (Demo Dollar - representing USDC):**
    *   **Type:** Standard ERC20.
    *   **Function:** The stable unit of account for the entire economy. It is used for all economic transactions, including loan principals, fee payments (`actionFee`), and the distribution of Reputation Dividends.
    *   **Acquisition:** Acquired on the open market, like any standard stablecoin.